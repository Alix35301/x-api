FROM node:20-alpine

# Install pnpm
RUN npm install -g pnpm@9

WORKDIR /app

# Copy root package files and workspace config
COPY package.json pnpm-workspace.yaml pnpm-lock.yaml* ./

# Copy shared packages
COPY packages ./packages

# Copy API package.json
COPY apps/api/package.json ./apps/api/

# Install all dependencies
RUN pnpm install --frozen-lockfile

# Copy API source
COPY apps/api ./apps/api

WORKDIR /app/apps/api

EXPOSE 3000

# Run in development mode with hot reload
CMD ["pnpm", "dev"]
